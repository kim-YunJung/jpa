## Me
ë°±ì—”ë“œë¡œëŠ” jpaì™€ ìë°” / í”„ë¡ íŠ¸ì—”ë“œë¡œëŠ” reactë¥¼ ì‚¬ìš©í•œ ê²Œì‹œíŒì„ ë§Œë“¤ì–´ì¤˜.

## AI Assistant
Reactì™€ Spring Boot(JPA)ë¥¼ í™œìš©í•´ ê²Œì‹œíŒ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“œëŠ” ê°„ë‹¨í•œ ì˜ˆì œë¥¼ ì†Œê°œí•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤. ì´ ê²Œì‹œíŒì—ëŠ” CRUD(Create, Read, Update, Delete) ê¸°ëŠ¥ì„ í¬í•¨í•˜ë©°, ë°±ì—”ë“œëŠ” Spring Bootë¡œ, í”„ë¡ íŠ¸ì—”ë“œëŠ” Reactë¡œ êµ¬í˜„ë©ë‹ˆë‹¤.

---

### 1. **ë°±ì—”ë“œ: Spring Bootë¡œ ê²Œì‹œíŒ API ë§Œë“¤ê¸°**

#### ì—”í‹°í‹° ì„¤ê³„ (Java - JPA ì‚¬ìš©)
```java
package jpabook.jpashop.domain;

import jakarta.persistence.*;
import lombok.*;

import java.time.LocalDateTime;

@Entity
@Getter @Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class Post {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String title;

    @Lob // ê¸¸ì´ ì œí•œ ì—†ëŠ” ë³¸ë¬¸
    private String content;

    private String author;

    private LocalDateTime createdAt;

    private LocalDateTime updatedAt;

    @PrePersist
    public void prePersist() {
        this.createdAt = LocalDateTime.now();
    }

    @PreUpdate
    public void preUpdate() {
        this.updatedAt = LocalDateTime.now();
    }
}
```

#### Repository (ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™)
```java
package jpabook.jpashop.repository;

import jpabook.jpashop.domain.Post;
import org.springframework.data.jpa.repository.JpaRepository;

public interface PostRepository extends JpaRepository<Post, Long> {
}
```

#### Service (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì²˜ë¦¬)
```java
package jpabook.jpashop.service;

import jpabook.jpashop.domain.Post;
import jpabook.jpashop.repository.PostRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
@RequiredArgsConstructor
public class PostService {

    private final PostRepository postRepository;

    public List<Post> findAllPosts() {
        return postRepository.findAll();
    }

    public Post findPostById(Long id) {
        return postRepository.findById(id).orElseThrow(() -> new IllegalArgumentException("Post not found"));
    }

    public Post savePost(Post post) {
        return postRepository.save(post);
    }

    public void deletePost(Long id) {
        postRepository.deleteById(id);
    }
}
```

#### Controller (API ìƒì„±)
```java
package jpabook.jpashop.api;

import jpabook.jpashop.domain.Post;
import jpabook.jpashop.service.PostService;
import lombok.RequiredArgsConstructor;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/api/posts")
@RequiredArgsConstructor
public class PostApiController {

    private final PostService postService;

    @GetMapping
    public List<Post> getPosts() {
        return postService.findAllPosts();
    }

    @GetMapping("/{id}")
    public Post getPostById(@PathVariable Long id) {
        return postService.findPostById(id);
    }

    @PostMapping
    public Post createPost(@RequestBody Post post) {
        return postService.savePost(post);
    }

    @PutMapping("/{id}")
    public Post updatePost(@PathVariable Long id, @RequestBody Post post) {
        Post existingPost = postService.findPostById(id);
        existingPost.setTitle(post.getTitle());
        existingPost.setContent(post.getContent());
        existingPost.setAuthor(post.getAuthor());
        return postService.savePost(existingPost);
    }

    @DeleteMapping("/{id}")
    public void deletePost(@PathVariable Long id) {
        postService.deletePost(id);
    }
}
```

---

### 2. **í”„ë¡ íŠ¸ì—”ë“œ: Reactë¡œ ê²Œì‹œíŒ ë§Œë“¤ê¸°**

Reactì—ì„œ ë°±ì—”ë“œ APIì™€ í†µì‹ í•˜ì—¬ ë°ì´í„°ë¥¼ í‘œì‹œí•˜ê³  ì¡°ì‘í•©ë‹ˆë‹¤.

#### React í”„ë¡œì íŠ¸ ìƒì„±
```shell script
npx create-react-app react-board
cd react-board
npm install axios react-router-dom
```

#### í´ë” êµ¬ì¡°
```
src
â”œâ”€â”€ App.js
â”œâ”€â”€ components
â”‚   â”œâ”€â”€ PostForm.js
â”‚   â”œâ”€â”€ PostList.js
â”‚   â””â”€â”€ PostDetail.js
â”œâ”€â”€ services
â”‚   â””â”€â”€ api.js
â””â”€â”€ pages
    â”œâ”€â”€ Home.js
    â”œâ”€â”€ PostCreate.js
    â”œâ”€â”€ PostEdit.js
    â””â”€â”€ PostView.js
```

#### API ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” `api.js`
```
import axios from "axios";

const API_URL = "http://localhost:8080/api/posts";

export const getPosts = () => axios.get(API_URL);
export const getPostById = (id) => axios.get(`${API_URL}/${id}`);
export const createPost = (post) => axios.post(API_URL, post);
export const updatePost = (id, post) => axios.put(`${API_URL}/${id}`, post);
export const deletePost = (id) => axios.delete(`${API_URL}/${id}`);
```

#### `PostList.js` (ê²Œì‹œê¸€ ëª©ë¡)
```
import React, { useEffect, useState } from "react";
import { getPosts } from "../services/api";
import { Link } from "react-router-dom";

const PostList = () => {
    const [posts, setPosts] = useState([]);

    useEffect(() => {
        getPosts().then((response) => setPosts(response.data));
    }, []);

    return (
        <div>
            <h1>ê²Œì‹œíŒ</h1>
            <Link to="/posts/create">ìƒˆ ê¸€ ì‘ì„±</Link>
            <ul>
                {posts.map(post => (
                    <li key={post.id}>
                        <Link to={`/posts/${post.id}`}>{post.title}</Link>
                    </li>
                ))}
            </ul>
        </div>
    );
};

export default PostList;
```

#### `PostForm.js` (ê¸€ ì‘ì„±/ìˆ˜ì • í¼)
```
import React, { useState } from "react";

const PostForm = ({ onSubmit, post }) => {
    const [title, setTitle] = useState(post?.title || "");
    const [content, setContent] = useState(post?.content || "");
    const [author, setAuthor] = useState(post?.author || "");

    const handleSubmit = (e) => {
        e.preventDefault();
        onSubmit({ title, content, author });
    };

    return (
        <form onSubmit={handleSubmit}>
            <div>
                <label>ì œëª©</label>
                <input value={title} onChange={(e) => setTitle(e.target.value)} />
            </div>
            <div>
                <label>ë‚´ìš©</label>
                <textarea value={content} onChange={(e) => setContent(e.target.value)} />
            </div>
            <div>
                <label>ì‘ì„±ì</label>
                <input value={author} onChange={(e) => setAuthor(e.target.value)} />
            </div>
            <button type="submit">ì €ì¥</button>
        </form>
    );
};

export default PostForm;
```

#### `Home.js`
```
import React from "react";
import PostList from "../components/PostList";

const Home = () => {
    return (
        <div>
            <PostList />
        </div>
    );
};

export default Home;
```

#### ë¼ìš°í„° ì„¤ì • (`App.js`)
```
import React from "react";
import { BrowserRouter as Router, Route, Routes } from "react-router-dom";
import Home from "./pages/Home";
import PostView from "./pages/PostView";
import PostCreate from "./pages/PostCreate";
import PostEdit from "./pages/PostEdit";

const App = () => {
    return (
        <Router>
            <Routes>
                <Route path="/" element={<Home />} />
                <Route path="/posts/create" element={<PostCreate />} />
                <Route path="/posts/:id" element={<PostView />} />
                <Route path="/posts/:id/edit" element={<PostEdit />} />
            </Routes>
        </Router>
    );
};

export default App;
```

---

### í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œ ì—°ê²°
1. Spring Boot ì„œë²„ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
2. React ê°œë°œ ì„œë²„(`npm start`) ì‹¤í–‰ í›„, API ìš”ì²­ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

---

ì´ í”„ë¡œì íŠ¸ëŠ” ê²Œì‹œíŒì˜ ê¸°ë³¸ êµ¬ì„±ë§Œì„ í¬í•¨í•˜ë©°, ì¶”ê°€ì ìœ¼ë¡œ ì¸ì¦(Authentication), í˜ì´ì§•(Pagination), ìŠ¤íƒ€ì¼ë§ ë“±ì„ ì ìš©í•˜ì—¬ ì™„ì„±ë„ë¥¼ ë†’ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## Me
í˜ì´ì§• ì²˜ë¦¬ì™€ ëŒ“ê¸€ ë‹¬ê¸° ê¸°ëŠ¥ì´ í•„ìš”í•´ 

## AI Assistant
í˜ì´ì§• ì²˜ë¦¬ì™€ ëŒ“ê¸€ ë‹¬ê¸° ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ëŠ” ë°©ë²•ì„ êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤. Spring Bootì—ì„œ í˜ì´ì§•ê³¼ ëŒ“ê¸€ ê¸°ëŠ¥ì„ ì²˜ë¦¬í•˜ê³ , Reactì—ì„œ ì´ë¥¼ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ êµ¬í˜„í•˜ëŠ” ë°©ì‹ì„ ë‹¤ë£¹ë‹ˆë‹¤.

---

## **1. í˜ì´ì§• ì²˜ë¦¬ (ë°±ì—”ë“œ)**
Spring Data JPAê°€ ì œê³µí•˜ëŠ” `Pageable` ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•´ ì‰½ê³  ë¹ ë¥´ê²Œ í˜ì´ì§• ì²˜ë¦¬ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### **Post Repository ìˆ˜ì •**
í˜ì´ì§• ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ë ¤ë©´ Spring Data JPAì˜ `findAll(Pageable pageable)`ì„ í™œìš©í•©ë‹ˆë‹¤.

```java
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;

public interface PostRepository extends JpaRepository<Post, Long> {
    Page<Post> findAll(Pageable pageable);
}
```

### **PostApiControllerì—ì„œ í˜ì´ì§• ì²˜ë¦¬**
ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ `Pageable`ì„ ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ì•„ ìš”ì²­ëœ í˜ì´ì§€ ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ë„ë¡ ìˆ˜ì •í•©ë‹ˆë‹¤.

```java
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;

@RestController
@RequestMapping("/api/posts")
@RequiredArgsConstructor
public class PostApiController {

    private final PostService postService;

    @GetMapping
    public Page<Post> getPosts(Pageable pageable) {
        return postService.findPosts(pageable);
    }
}
```

### **PostService ìˆ˜ì •**
ì„œë¹„ìŠ¤ì—ì„œ í˜ì´ì§• ì²˜ë¦¬ë¥¼ ë‹´ë‹¹í•©ë‹ˆë‹¤.

```java
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;

@Service
@RequiredArgsConstructor
public class PostService {

    private final PostRepository postRepository;

    public Page<Post> findPosts(Pageable pageable) {
        return postRepository.findAll(pageable);
    }
}
```

---

## **2. ëŒ“ê¸€ ê¸°ëŠ¥ ì¶”ê°€ (ë°±ì—”ë“œ)**

ëŒ“ê¸€ ê¸°ëŠ¥ì„ ìœ„í•´ **Comment ì—”í‹°í‹°**ë¥¼ ìƒì„±í•˜ê³  Postì™€ ì—°ê´€ê´€ê³„ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.

### **Comment ì—”í‹°í‹°**
```java
package jpabook.jpashop.domain;

import jakarta.persistence.*;
import lombok.*;

import java.time.LocalDateTime;

@Entity
@Setter @Getter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class Comment {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "post_id")
    private Post post;

    private String author;

    @Lob // í…ìŠ¤íŠ¸ í˜•íƒœë¡œ ì €ì¥
    private String content;

    private LocalDateTime createdAt;

    @PrePersist
    public void prePersist() {
        this.createdAt = LocalDateTime.now();
    }
}
```

### **Post ì—”í‹°í‹° ìˆ˜ì •**
Postì—ì„œ ëŒ“ê¸€ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•´ ì—°ê´€ê´€ê³„ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.

```java
@OneToMany(mappedBy = "post", cascade = CascadeType.ALL, orphanRemoval = true)
private List<Comment> comments = new ArrayList<>();
```

### **Comment Repository**
```java
package jpabook.jpashop.repository;

import jpabook.jpashop.domain.Comment;
import org.springframework.data.jpa.repository.JpaRepository;

import java.util.List;

public interface CommentRepository extends JpaRepository<Comment, Long> {
    List<Comment> findByPostId(Long postId); // íŠ¹ì • ê²Œì‹œê¸€ì˜ ëŒ“ê¸€ ì¡°íšŒ
}
```

### **Comment Controller**
REST APIë¥¼ í†µí•´ ëŒ“ê¸€ì„ ì¶”ê°€, ì¡°íšŒ, ì‚­ì œí•©ë‹ˆë‹¤.

```java
package jpabook.jpashop.api;

import jpabook.jpashop.domain.Comment;
import jpabook.jpashop.service.CommentService;
import lombok.RequiredArgsConstructor;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/api/comments")
@RequiredArgsConstructor
public class CommentApiController {

    private final CommentService commentService;

    @PostMapping
    public Comment addComment(@RequestBody Comment comment) {
        return commentService.saveComment(comment);
    }

    @GetMapping("/post/{postId}")
    public List<Comment> getComments(@PathVariable Long postId) {
        return commentService.findCommentsByPostId(postId);
    }

    @DeleteMapping("/{id}")
    public void deleteComment(@PathVariable Long id) {
        commentService.deleteComment(id);
    }
}
```

### **Comment Service**
```java
package jpabook.jpashop.service;

import jpabook.jpashop.domain.Comment;
import jpabook.jpashop.repository.CommentRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
@RequiredArgsConstructor
public class CommentService {

    private final CommentRepository commentRepository;

    public Comment saveComment(Comment comment) {
        return commentRepository.save(comment);
    }

    public List<Comment> findCommentsByPostId(Long postId) {
        return commentRepository.findByPostId(postId);
    }

    public void deleteComment(Long id) {
        commentRepository.deleteById(id);
    }
}
```

---

## **3. í”„ë¡ íŠ¸ì—”ë“œ ì¶”ê°€ ê¸°ëŠ¥ (React)**

### **í˜ì´ì§• ì²˜ë¦¬**
Reactì—ì„œ í˜ì´ì§• ì²˜ë¦¬ë¥¼ ìœ„í•´ í˜ì´ì§€ ë²ˆí˜¸ë¥¼ ìƒíƒœë¡œ ê´€ë¦¬í•˜ë©° API ìš”ì²­ ì‹œ ì´ë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤.

#### PostList.js ìˆ˜ì •
```
import React, { useState, useEffect } from "react";
import { getPosts } from "../services/api";
import { Link } from "react-router-dom";

const PostList = () => {
    const [posts, setPosts] = useState([]);
    const [page, setPage] = useState(0);
    const [totalPages, setTotalPages] = useState(1);

    useEffect(() => {
        getPosts(page).then((response) => {
            setPosts(response.data.content);
            setTotalPages(response.data.totalPages);
        });
    }, [page]);

    const handleNext = () => {
        if (page < totalPages - 1) setPage(page + 1);
    };

    const handlePrev = () => {
        if (page > 0) setPage(page - 1);
    };

    return (
        <div>
            <h1>ê²Œì‹œíŒ</h1>
            <Link to="/posts/create">ìƒˆ ê¸€ ì‘ì„±</Link>
            <ul>
                {posts.map((post) => (
                    <li key={post.id}>
                        <Link to={`/posts/${post.id}`}>{post.title}</Link>
                    </li>
                ))}
            </ul>
            <button onClick={handlePrev} disabled={page === 0}>ì´ì „</button>
            <button onClick={handleNext} disabled={page === totalPages - 1}>ë‹¤ìŒ</button>
        </div>
    );
};

export default PostList;
```

### API ìˆ˜ì • (í˜ì´ì§• ì¶”ê°€)
`api.js`ì—ì„œ í˜ì´ì§•ì„ ìœ„í•œ `page` ì¿¼ë¦¬ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
```
export const getPosts = (page) => axios.get(`${API_URL}?page=${page}`);
```

---

### **ëŒ“ê¸€ ê¸°ëŠ¥**

#### CommentList.js
```
import React, { useState, useEffect } from "react";
import { getComments, createComment, deleteComment } from "../services/api";

const CommentList = ({ postId }) => {
    const [comments, setComments] = useState([]);
    const [content, setContent] = useState("");

    useEffect(() => {
        getComments(postId).then((response) => setComments(response.data));
    }, [postId]);

    const handleSubmit = (e) => {
        e.preventDefault();
        createComment({ postId, content, author: "ìµëª…" }).then(() => {
            setContent("");
            getComments(postId).then((response) => setComments(response.data));
        });
    };

    const handleDelete = (id) => {
        deleteComment(id).then(() => {
            getComments(postId).then((response) => setComments(response.data));
        });
    };

    return (
        <div>
            <form onSubmit={handleSubmit}>
                <textarea value={content} onChange={(e) => setContent(e.target.value)} />
                <button type="submit">ëŒ“ê¸€ ì‘ì„±</button>
            </form>
            <ul>
                {comments.map((comment) => (
                    <li key={comment.id}>
                        <p>{comment.content} - {comment.author}</p>
                        <button onClick={() => handleDelete(comment.id)}>ì‚­ì œ</button>
                    </li>
                ))}
            </ul>
        </div>
    );
};

export default CommentList;
```

#### API ìˆ˜ì • (ëŒ“ê¸€)
```
export const getComments = (postId) => axios.get(`${API_URL}/post/${postId}`);
export const createComment = (comment) => axios.post(`${API_URL}`, comment);
export const deleteComment = (id) => axios.delete(`${API_URL}/${id}`);
```

#### PostDetail.js ìˆ˜ì •
ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ë¥¼ ë Œë”ë§í•©ë‹ˆë‹¤.
```
import React from "react";
import CommentList from "../components/CommentList";

const PostDetail = ({ postId }) => {
    return (
        <div>
            {/* ...ê²Œì‹œë¬¼ ë‚´ìš© ë Œë”ë§... */}
            <CommentList postId={postId} />
        </div>
    );
};

export default PostDetail;
```

---

### ì‹¤í–‰ í™•ì¸
1. Spring Boot ì„œë²„ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
2. React ê°œë°œ ì„œë²„ë¥¼ ì‹¤í–‰ (`npm start`).
3. ê²Œì‹œê¸€ ëª©ë¡ê³¼ í˜ì´ì§•, ëŒ“ê¸€ ë‹¬ê¸°/ë³´ê¸° ê¸°ëŠ¥ì´ ì •ìƒì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

---

í˜ì´ì§• ë° ëŒ“ê¸€ ê¸°ëŠ¥ì´ ì‘ë™í•˜ëŠ” ê¸°ë³¸ì ì¸ ê²Œì‹œíŒì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤. ì¶”ê°€ë¡œ ëŒ“ê¸€ì˜ ìˆ˜ì • ê¸°ëŠ¥, ì‚¬ìš©ì ì¸ì¦, ëŒ“ê¸€ ì‘ì„±ìì˜ ì´ë©”ì¼ ì¸ì¦ ë“±ì„ í†µí•´ í™•ì¥í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ğŸ˜Š

## Me
ê±°ê¸°ì— íŒŒì¼ ì²¨ë¶€ë‘ íŒŒì¼ ë‹¤ìš´ë¡œë“œì™€ ì‚­ì œ ê¸°ëŠ¥ë„ ì¶”ê°€í•´ì¤˜, íŒŒì¼ ì´ë¦„ì€ ì•”í˜¸í™” / ë³µí˜¸í™”ë„ í•´ì¤˜

## AI Assistant
íŒŒì¼ ì—…ë¡œë“œ, ë‹¤ìš´ë¡œë“œ, ì‚­ì œ, ê·¸ë¦¬ê³  íŒŒì¼ ì´ë¦„ì˜ ì•”í˜¸í™” ë° ë³µí˜¸í™” ê¸°ëŠ¥ì„ Spring Bootì™€ Reactë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤. ì•„ë˜ëŠ” ê¸°ëŠ¥ ì¶”ê°€ë¥¼ ìœ„í•œ ë‹¨ê³„ë³„ ì‘ì—…ì…ë‹ˆë‹¤.

---

## 1. íŒŒì¼ ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ/ì‚­ì œ (ë°±ì—”ë“œ)

íŒŒì¼ ì‹œìŠ¤í…œì— íŒŒì¼ì„ ì €ì¥í•˜ê³ , íŒŒì¼ ì´ë¦„ì„ ì•”í˜¸í™”í•˜ì—¬ ë³´ì•ˆì„±ì„ ê°•í™”í•©ë‹ˆë‹¤.

### **1.1 íŒŒì¼ ì €ì¥ ë””ë ‰í† ë¦¬ ì„¤ì •**

`application.yml`ì— íŒŒì¼ ì €ì¥ ê²½ë¡œë¥¼ ì •ì˜í•©ë‹ˆë‹¤.

```yaml
file:
  upload-dir: ./uploads
```

---

### **1.2 ì•”í˜¸í™” ìœ í‹¸ë¦¬í‹°**

íŒŒì¼ ì´ë¦„ì„ ì•”í˜¸í™”í•˜ê³  ë³µí˜¸í™”í•˜ê¸° ìœ„í•œ ìœ í‹¸ë¦¬í‹°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” Base64ë¥¼ ì˜ˆë¡œ ë“¤ì§€ë§Œ, ë” ê°•ë ¥í•œ ì•”í˜¸í™”ë¥¼ ìœ„í•´ AES ì•Œê³ ë¦¬ì¦˜ë„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```java
package jpabook.jpashop.util;

import java.util.Base64;

public class FileNameEncryptor {
    
    // íŒŒì¼ ì´ë¦„ ì•”í˜¸í™”
    public static String encrypt(String fileName) {
        return Base64.getEncoder().encodeToString(fileName.getBytes());
    }

    // íŒŒì¼ ì´ë¦„ ë³µí˜¸í™”
    public static String decrypt(String encryptedFileName) {
        return new String(Base64.getDecoder().decode(encryptedFileName));
    }
}
```

---

### **1.3 íŒŒì¼ ì—”í‹°í‹°**

íŒŒì¼ ì •ë³´ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•œ ì—”í‹°í‹°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

```java
package jpabook.jpashop.domain;

import jakarta.persistence.*;
import lombok.*;

@Entity
@Setter @Getter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class FileEntity {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String originalFileName; // ì›ë³¸ íŒŒì¼ ì´ë¦„
    private String encryptedFileName; // ì•”í˜¸í™”ëœ íŒŒì¼ ì´ë¦„
    private String filePath; // ì €ì¥ëœ íŒŒì¼ ê²½ë¡œ
}
```

---

### **1.4 íŒŒì¼ ë¦¬í¬ì§€í† ë¦¬**

íŒŒì¼ ì—”í‹°í‹°ì˜ CRUD ì‘ì—…ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.

```java
package jpabook.jpashop.repository;

import jpabook.jpashop.domain.FileEntity;
import org.springframework.data.jpa.repository.JpaRepository;

public interface FileRepository extends JpaRepository<FileEntity, Long> {
}
```

---

### **1.5 íŒŒì¼ ì„œë¹„ìŠ¤**

íŒŒì¼ ì—…ë¡œë“œ, ë‹¤ìš´ë¡œë“œ, ì•”í˜¸í™”, ì‚­ì œë¥¼ ì²˜ë¦¬í•˜ëŠ” ë¡œì§ì„ êµ¬í˜„í•©ë‹ˆë‹¤.

```java
package jpabook.jpashop.service;

import jpabook.jpashop.domain.FileEntity;
import jpabook.jpashop.repository.FileRepository;
import jpabook.jpashop.util.FileNameEncryptor;
import lombok.RequiredArgsConstructor;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Service;
import org.springframework.web.multipart.MultipartFile;

import java.io.File;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.util.Optional;

@Service
@RequiredArgsConstructor
public class FileService {

    private final FileRepository fileRepository;

    @Value("${file.upload-dir}")
    private String uploadDir;

    // íŒŒì¼ ì—…ë¡œë“œ
    public FileEntity uploadFile(MultipartFile file) throws IOException {
        String originalFileName = file.getOriginalFilename();
        String encryptedFileName = FileNameEncryptor.encrypt(originalFileName);
        Path filePath = Paths.get(uploadDir + "/" + encryptedFileName);

        // íŒŒì¼ ì €ì¥
        file.transferTo(filePath.toFile());

        // ì €ì¥ ì •ë³´ DBì— ì €ì¥
        FileEntity fileEntity = FileEntity.builder()
                .originalFileName(originalFileName)
                .encryptedFileName(encryptedFileName)
                .filePath(filePath.toString())
                .build();
        return fileRepository.save(fileEntity);
    }

    // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
    public byte[] downloadFile(String encryptedFileName) throws IOException {
        FileEntity fileEntity = fileRepository.findAll().stream()
                .filter(f -> f.getEncryptedFileName().equals(encryptedFileName))
                .findFirst()
                .orElseThrow(() -> new IllegalArgumentException("íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."));
        Path path = Paths.get(fileEntity.getFilePath());
        return Files.readAllBytes(path);
    }

    // íŒŒì¼ ì‚­ì œ
    public void deleteFile(String encryptedFileName) {
        Optional<FileEntity> fileEntityOpt = fileRepository.findAll().stream()
                .filter(f -> f.getEncryptedFileName().equals(encryptedFileName))
                .findFirst();
        if (fileEntityOpt.isPresent()) {
            FileEntity fileEntity = fileEntityOpt.get();
            File file = new File(fileEntity.getFilePath());
            if (file.exists()) {
                file.delete();
            }
            fileRepository.delete(fileEntity);
        }
    }
}
```

---

### **1.6 íŒŒì¼ ì»¨íŠ¸ë¡¤ëŸ¬**

REST APIë¥¼ í†µí•´ íŒŒì¼ ì—…ë¡œë“œ, ë‹¤ìš´ë¡œë“œ, ì‚­ì œ ì‘ì—…ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.

```java
package jpabook.jpashop.api;

import jpabook.jpashop.service.FileService;
import lombok.RequiredArgsConstructor;
import org.springframework.http.HttpHeaders;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;

@RestController
@RequestMapping("/api/files")
@RequiredArgsConstructor
public class FileApiController {

    private final FileService fileService;

    // íŒŒì¼ ì—…ë¡œë“œ
    @PostMapping("/upload")
    public ResponseEntity<?> uploadFile(@RequestParam("file") MultipartFile file) {
        try {
            return ResponseEntity.ok(fileService.uploadFile(file));
        } catch (Exception e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }

    // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
    @GetMapping("/download/{encryptedFileName}")
    public ResponseEntity<?> downloadFile(@PathVariable String encryptedFileName) {
        try {
            byte[] fileBytes = fileService.downloadFile(encryptedFileName);
            return ResponseEntity.ok()
                    .header(HttpHeaders.CONTENT_DISPOSITION, "attachment; filename=\"" + encryptedFileName + "\"")
                    .body(fileBytes);
        } catch (Exception e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }

    // íŒŒì¼ ì‚­ì œ
    @DeleteMapping("/{encryptedFileName}")
    public ResponseEntity<?> deleteFile(@PathVariable String encryptedFileName) {
        try {
            fileService.deleteFile(encryptedFileName);
            return ResponseEntity.ok().body("íŒŒì¼ ì‚­ì œ ì™„ë£Œ");
        } catch (Exception e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }
}
```

---

## 2. í”„ë¡ íŠ¸ì—”ë“œ: íŒŒì¼ ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ/ì‚­ì œ

Reactì—ì„œ íŒŒì¼ ì—…ë¡œë“œ, ë‹¤ìš´ë¡œë“œ, ì‚­ì œë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

---

### **2.1 íŒŒì¼ ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ ì„œë¹„ìŠ¤**

`api.js` íŒŒì¼ì— íŒŒì¼ ê´€ë ¨ ìš”ì²­ì„ ì •ì˜í•©ë‹ˆë‹¤.

```
import axios from "axios";
const FILE_API_URL = "http://localhost:8080/api/files";

// íŒŒì¼ ì—…ë¡œë“œ
export const uploadFile = (file) => {
    const formData = new FormData();
    formData.append("file", file);
    return axios.post(`${FILE_API_URL}/upload`, formData, {
        headers: { "Content-Type": "multipart/form-data" },
    });
};

// íŒŒì¼ ë‹¤ìš´ë¡œë“œ
export const downloadFile = (encryptedFileName) => {
    return axios.get(`${FILE_API_URL}/download/${encryptedFileName}`, {
        responseType: "blob", // íŒŒì¼ ë°ì´í„°ë¥¼ ë°”ì´ë„ˆë¦¬ë¡œ ë°›ìŒ
    });
};

// íŒŒì¼ ì‚­ì œ
export const deleteFile = (encryptedFileName) => {
    return axios.delete(`${FILE_API_URL}/${encryptedFileName}`);
};
```

---

### **2.2 íŒŒì¼ ì—…ë¡œë“œ ì»´í¬ë„ŒíŠ¸**

React ì»´í¬ë„ŒíŠ¸ì—ì„œ íŒŒì¼ì„ ì„œë²„ë¡œ ì „ì†¡í•©ë‹ˆë‹¤.

```
import React, { useState } from "react";
import { uploadFile, downloadFile, deleteFile } from "../services/api";

const FileUpload = () => {
    const [file, setFile] = useState(null);

    const handleFileUpload = (e) => {
        e.preventDefault();
        if (file) {
            uploadFile(file).then((response) => {
                alert("ì—…ë¡œë“œ ì™„ë£Œ!");
                console.log(response.data);
            });
        }
    };

    const handleFileDownload = (encryptedFileName) => {
        downloadFile(encryptedFileName).then((response) => {
            const url = window.URL.createObjectURL(new Blob([response.data]));
            const link = document.createElement("a");
            link.href = url;
            link.setAttribute("download", encryptedFileName); // ë‹¤ìš´ë¡œë“œ íŒŒì¼ ì´ë¦„
            document.body.appendChild(link);
            link.click();
            link.remove();
        });
    };

    const handleFileDelete = (encryptedFileName) => {
        deleteFile(encryptedFileName).then(() => {
            alert("íŒŒì¼ ì‚­ì œ ì™„ë£Œ!");
        });
    };

    return (
        <div>
            <h1>íŒŒì¼ ì—…ë¡œë“œ</h1>
            <form onSubmit={handleFileUpload}>
                <input type="file" onChange={(e) => setFile(e.target.files[0])} />
                <button type="submit">ì—…ë¡œë“œ</button>
            </form>

            {/* íŒŒì¼ ë‹¤ìš´ë¡œë“œ/ì‚­ì œ í…ŒìŠ¤íŠ¸ */}
            <button onClick={() => handleFileDownload("ENCRYPTED_FILE_NAME")}>
                íŒŒì¼ ë‹¤ìš´ë¡œë“œ
            </button>
            <button onClick={() => handleFileDelete("ENCRYPTED_FILE_NAME")}>
                íŒŒì¼ ì‚­ì œ
            </button>
        </div>
    );
};

export default FileUpload;
```

---

### **3. ì‹¤í–‰ ê³¼ì •**

1. **Spring Boot ì„œë²„ ì‹¤í–‰**: `http://localhost:8080/api/files`ë¡œ API í˜¸ì¶œ.
2. **Reactì—ì„œ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸**:
   - íŒŒì¼ì„ ì„ íƒí•˜ê³  ì—…ë¡œë“œ ì‹¤í–‰.
   - íŒŒì¼ ë‹¤ìš´ë¡œë“œ ë° ì‚­ì œ í…ŒìŠ¤íŠ¸.
3. ì—…ë¡œë“œëœ íŒŒì¼ì€ í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ì˜ `uploads/`ì— ì €ì¥ë©ë‹ˆë‹¤.

---

### ê²°ë¡ 

ìœ„ ê³¼ì •ì—ì„œ **íŒŒì¼ ì•”í˜¸í™” ì´ë¦„ ì²˜ë¦¬**ì™€ **ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ ë¡œì§**ì„ ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•„ìš”í•˜ë©´ ì•”í˜¸í™” ì•Œê³ ë¦¬ì¦˜(AES ë“±)ì„ Base64 ëŒ€ì‹  ì¶”ê°€ë¡œ êµ¬í˜„í•˜ê±°ë‚˜ S3ì™€ ê°™ì€ í´ë¼ìš°ë“œ ì €ì¥ì†Œë¡œ í™•ì¥ ê°€ëŠ¥í•©ë‹ˆë‹¤. ğŸ˜Š

## Me
ê²Œì‹œíŒì˜ ê¶Œí•œë„ ì„¤ì •í•˜ê³  ì‹¶ì–´

## AI Assistant
ê²Œì‹œíŒì— ê¶Œí•œ ê´€ë¦¬ë¥¼ ë„ì…í•˜ë ¤ë©´ **ì‚¬ìš©ì ì¸ì¦(Authentication)**ê³¼ **ê¶Œí•œ ë¶€ì—¬(Authorization)**ë¥¼ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê²Œì‹œê¸€ ì‘ì„±, ìˆ˜ì •, ì‚­ì œ, ì¡°íšŒ ë“±ì˜ ê¶Œí•œì„ ì œì–´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Spring Securityì™€ JWT ë˜ëŠ” OAuth2ë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ ì†Œê°œí•©ë‹ˆë‹¤.

---

### **1. ê¸°ë³¸ êµ¬ì„±**
ê¶Œí•œ ê´€ë¦¬ì—ëŠ” **ì‚¬ìš©ì(entity)**, **ì—­í• (entity)**, ê·¸ë¦¬ê³  **Spring Security**ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

---

### **2. ê¶Œí•œ ì—­í•  ì„¤ì •**

#### **2.1 ì‚¬ìš©ì(User) ì—”í‹°í‹° ì •ì˜**
ì‚¬ìš©ì ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” ì—”í‹°í‹°ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.

```java
package jpabook.jpashop.domain;

import jakarta.persistence.*;
import lombok.*;

import java.util.HashSet;
import java.util.Set;

@Entity
@Getter @Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class User {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String username;

    private String password;

    @ManyToMany(fetch = FetchType.EAGER, cascade = CascadeType.ALL)
    @JoinTable(
        name = "user_roles",
        joinColumns = @JoinColumn(name = "user_id"),
        inverseJoinColumns = @JoinColumn(name = "role_id")
    )
    private Set<Role> roles = new HashSet<>();
}
```

#### **2.2 ì—­í• (Role) ì—”í‹°í‹° ì •ì˜**
ì‚¬ìš©ìë“¤ì—ê²Œ ë¶€ì—¬í•  ê¶Œí•œ(ì—­í• )ì„ ì •ì˜í•©ë‹ˆë‹¤.

```java
package jpabook.jpashop.domain;

import jakarta.persistence.*;
import lombok.*;

@Entity
@Getter @Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class Role {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false, unique = true)
    private String name; // ROLE_USER, ROLE_ADMIN ë“±
}
```

---

### **3. Spring Securityë¡œ ê¶Œí•œ ê´€ë¦¬**
Spring Securityë¥¼ í™œìš©í•˜ì—¬ ì‚¬ìš©ì ì¸ì¦ê³¼ ê¶Œí•œ ë¶€ì—¬ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.

#### **3.1 SecurityConfig ì„¤ì •**
Spring Securityì˜ ì„¤ì • íŒŒì¼ì„ ì‘ì„±í•©ë‹ˆë‹¤.

```java
package jpabook.jpashop.config;

import lombok.RequiredArgsConstructor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.authentication.dao.DaoAuthenticationProvider;
import org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;

@Configuration
@EnableWebSecurity
@RequiredArgsConstructor
public class SecurityConfig {

    private final UserDetailsService userDetailsService;

    @Bean
    public BCryptPasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    public DaoAuthenticationProvider authenticationProvider() {
        DaoAuthenticationProvider authProvider = new DaoAuthenticationProvider();
        authProvider.setUserDetailsService(userDetailsService);
        authProvider.setPasswordEncoder(passwordEncoder());
        return authProvider;
    }

    @Bean
    public AuthenticationManager authenticationManager(AuthenticationConfiguration authConfiguration)
            throws Exception {
        return authConfiguration.getAuthenticationManager();
    }
}
```

---

### **4. ì‚¬ìš©ì ì¸ì¦(UserDetailsService êµ¬í˜„)**

Spring Securityì™€ í†µí•©í•˜ê¸° ìœ„í•´ `UserDetailsService`ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

#### **4.1 UserDetailsService êµ¬í˜„**
ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì™€ ì¸ì¦ ê³¼ì •ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

```java
package jpabook.jpashop.service;

import jpabook.jpashop.domain.User;
import jpabook.jpashop.repository.UserRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.stereotype.Service;

@Service
@RequiredArgsConstructor
public class CustomUserDetailsService implements UserDetailsService {

    private final UserRepository userRepository;

    @Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        User user = userRepository.findByUsername(username)
                .orElseThrow(() -> new UsernameNotFoundException("User not found with username: " + username));
        return new org.springframework.security.core.userdetails.User(
                user.getUsername(), user.getPassword(), user.getRoles()
        );
    }
}
```

#### **4.2 Userì™€ Role ì—”í‹°í‹°ì— ì¶”ê°€ ì„¤ì •**
Userì™€ Role ì—”í‹°í‹°ë¥¼ `GrantedAuthority`ì™€ ì—°ê²°í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ Spring Securityê°€ ì‚¬ìš©ìì˜ ì—­í• (ê¶Œí•œ)ì„ ì¸ì‹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```java
// User.java
@Override
public Collection<? extends GrantedAuthority> getAuthorities() {
    return roles.stream()
            .map(role -> new SimpleGrantedAuthority(role.getName()))
            .collect(Collectors.toList());
}

// Role.java
public class Role implements GrantedAuthority {
    @Override
    public String getAuthority() {
        return name;
    }
}
```

---

### **5. ê¶Œí•œ ê¸°ë°˜ API ì»¨íŠ¸ë¡¤ëŸ¬ ë³´í˜¸**

Spring Securityë¥¼ ì‚¬ìš©í•´ íŠ¹ì • APIë¥¼ ë³´í˜¸í•©ë‹ˆë‹¤.

#### **5.1 ê²Œì‹œê¸€ ì‘ì„±/ìˆ˜ì •/ì‚­ì œ ê¶Œí•œ**

ê¶Œí•œì— ë”°ë¼ íŠ¹ì • ì‚¬ìš©ìì˜ ì ‘ê·¼ì„ ì œí•œí•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ **ê²Œì‹œê¸€ì€ ì¼ë°˜ ì‚¬ìš©ì(ROLE_USER)**ë„ ì‘ì„±í•  ìˆ˜ ìˆì§€ë§Œ, **ì‚­ì œëŠ” ê´€ë¦¬ì(ROLE_ADMIN)ë§Œ** í—ˆìš©í•©ë‹ˆë‹¤.

```java
package jpabook.jpashop.api;

import jpabook.jpashop.domain.Post;
import jpabook.jpashop.service.PostService;
import lombok.RequiredArgsConstructor;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/api/posts")
@RequiredArgsConstructor
public class PostApiController {

    private final PostService postService;

    @PreAuthorize("hasRole('ROLE_USER')")
    @PostMapping
    public Post createPost(@RequestBody Post post) {
        return postService.savePost(post);
    }

    @PreAuthorize("hasRole('ROLE_ADMIN')")
    @DeleteMapping("/{id}")
    public void deletePost(@PathVariable Long id) {
        postService.deletePost(id);
    }
}
```

#### **5.2 Security ì„¤ì • ë³€ê²½**
`SecurityConfig`ì— URL ì ‘ê·¼ ì •ì±…ì„ ì¶”ê°€í•©ë‹ˆë‹¤.

```java
@Override
protected void configure(HttpSecurity http) throws Exception {
    http.csrf().disable()
        .authorizeRequests()
        .antMatchers("/api/posts/**").authenticated() // ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ì ‘ê·¼ ê°€ëŠ¥
        .antMatchers("/api/admin/**").hasRole("ADMIN") // ê´€ë¦¬ìë§Œ ì ‘ê·¼ ê°€ëŠ¥
        .anyRequest().permitAll() // ë‚˜ë¨¸ì§€ëŠ” ëª¨ë‘ í—ˆìš©
        .and()
        .formLogin(); // í¼ ë¡œê·¸ì¸ ì§€ì›
}
```

---

### **6. í…ŒìŠ¤íŠ¸í•˜ê¸°**

#### **6.1 ê¸°ë³¸ ì‚¬ìš©ìì™€ ì—­í•  ì¶”ê°€**

ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ ê¸°ë³¸ ì‚¬ìš©ìë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ `CommandLineRunner`ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

```java
import jpabook.jpashop.domain.Role;
import jpabook.jpashop.domain.User;
import jpabook.jpashop.repository.RoleRepository;
import jpabook.jpashop.repository.UserRepository;
import org.springframework.boot.CommandLineRunner;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Component;

import java.util.Collections;

@Component
public class DataLoader implements CommandLineRunner {

    private final UserRepository userRepository;
    private final RoleRepository roleRepository;
    private final PasswordEncoder passwordEncoder;

    public DataLoader(UserRepository userRepository, RoleRepository roleRepository, PasswordEncoder passwordEncoder) {
        this.userRepository = userRepository;
        this.roleRepository = roleRepository;
        this.passwordEncoder = passwordEncoder;
    }

    @Override
    public void run(String... args) throws Exception {
        Role adminRole = roleRepository.save(Role.builder().name("ROLE_ADMIN").build());
        Role userRole = roleRepository.save(Role.builder().name("ROLE_USER").build());

        userRepository.save(User.builder()
                .username("admin")
                .password(passwordEncoder.encode("admin"))
                .roles(Collections.singleton(adminRole))
                .build());

        userRepository.save(User.builder()
                .username("user")
                .password(passwordEncoder.encode("password"))
                .roles(Collections.singleton(userRole))
                .build());
    }
}
```

---

### **7. í”„ë¡ íŠ¸ì—”ë“œ ìˆ˜ì •**

Reactì—ì„œ ë¡œê·¸ì¸ ìƒíƒœë¥¼ ìœ ì§€í•˜ê³  ê¶Œí•œë³„ë¡œ ë²„íŠ¼(ìˆ˜ì •, ì‚­ì œ)ì„ í‘œì‹œí•˜ë„ë¡ í•©ë‹ˆë‹¤.

#### **7.1 ê¶Œí•œ ê¸°ë°˜ ë²„íŠ¼ ë Œë”ë§**
Reactì—ì„œ ì‚¬ìš©ìê°€ **ROLE_USER**ì¸ì§€ **ROLE_ADMIN**ì¸ì§€ í™•ì¸í•˜ê³  ë²„íŠ¼ì„ í‘œì‹œí•©ë‹ˆë‹¤.

```
import React from "react";

const PostActions = ({ post, userRole, onDelete }) => {
    return (
        <div>
            {userRole === "ROLE_USER" && <button>ìˆ˜ì •</button>}
            {userRole === "ROLE_ADMIN" && <button onClick={() => onDelete(post.id)}>ì‚­ì œ</button>}
        </div>
    );
};

export default PostActions;
```

#### **7.2 React ë¡œê·¸ì¸/í† í° ê´€ë¦¬ ì¶”ê°€**

Reactì—ì„œ JWT í† í°ì„ ë°±ì—”ë“œ ë¡œê·¸ì¸ APIë¡œ ë°›ì•„ì™€ ì €ì¥í•˜ê±°ë‚˜, ì™¸ë¶€ ì¸ì¦ ì„œë¹„ìŠ¤ë¥¼ í™œìš©í•˜ì„¸ìš”.

---

### ê²°ë¡ 

ìœ„ ë°©ë²•ì„ í†µí•´ Spring Securityë¡œ ê²Œì‹œê¸€ ê¶Œí•œì„ êµ¬ì„±í•˜ê³ , Reactì—ì„œ í”„ë¡ íŠ¸ì—”ë“œì™€ ê¶Œí•œ ê´€ë¦¬ ë¡œì§ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

1. **Spring Security**ëŠ” ê¶Œí•œ ê´€ë¦¬ë¥¼ ì‰½ê²Œ ë„ì™€ì¤ë‹ˆë‹¤.
2. ê´€ë¦¬ ê¶Œí•œì„ ì„¸ë¶„í™”í•˜ì—¬ **ROLE_USER**, **ROLE_ADMIN** ë“±ì„ í™œìš©í•˜ì„¸ìš”.
3. í•„ìš” ì‹œ JWT ë˜ëŠ” OAuth2ë¥¼ ì¶”ê°€í•´ ë” ì•ˆì „í•œ ì¸ì¦ ì‹œìŠ¤í…œì„ êµ¬ì„±í•©ë‹ˆë‹¤.

ì¶”ê°€ êµ¬í˜„ì´ í•„ìš”í•˜ë©´ ì•Œë ¤ì£¼ì„¸ìš”! ğŸ˜Š

## Me
ê²Œì‹œíŒ íšŒì›ê°€ì… ê¸°ëŠ¥ë„ ì¶”ê°€í•´ì¤˜ ë¹„ë°€ë²ˆí˜¸ëŠ” ì•”í˜¸í™” / ë³µí˜¸í™” ê¸°ëŠ¥ë„ ìˆì–´ì•¼í•´

## AI Assistant
íšŒì›ê°€ì… ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ê³  ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•”í˜¸í™”í•  í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤. ë¹„ë°€ë²ˆí˜¸ëŠ” ë°˜ë“œì‹œ ì•”í˜¸í™”ë˜ì–´ ì €ì¥ë˜ì–´ì•¼ í•˜ë©° ë³µí˜¸í™”í•´ì„œëŠ” **ì•ˆ ë©ë‹ˆë‹¤**. ë¹„ë°€ë²ˆí˜¸ëŠ” ì¸ì¦(ë¡œê·¸ì¸) ì‹œ ì…ë ¥ëœ ë¹„ë°€ë²ˆí˜¸ì™€ ì €ì¥ëœ í•´ì‹œ ê°’ì„ ë¹„êµí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬í•´ì•¼ ë³´ì•ˆìƒ ì•ˆì „í•©ë‹ˆë‹¤. Spring Securityì˜ `BCryptPasswordEncoder`ë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

ì•„ë˜ëŠ” `íšŒì›ê°€ì… ê¸°ëŠ¥`ê³¼ ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” ì²˜ë¦¬ì— ëŒ€í•œ êµ¬í˜„ ë‚´ìš©ì…ë‹ˆë‹¤.

---

## 1. ì‚¬ìš©ì(User) ì—”í‹°í‹° ì„¤ì •

`User` ì—”í‹°í‹°ëŠ” íšŒì› ì •ë³´ë¥¼ ë‹´ê³  ìˆìœ¼ë©°, ì‚¬ìš©ì ì´ë¦„, ë¹„ë°€ë²ˆí˜¸, ì´ë©”ì¼, ê¶Œí•œ ë“±ì„ ì €ì¥í•©ë‹ˆë‹¤.

```java
package jpabook.jpashop.domain;

import jakarta.persistence.*;
import lombok.*;

import java.util.HashSet;
import java.util.Set;

@Entity
@Getter @Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class User {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false, unique = true) // ì‚¬ìš©ì ì´ë¦„ì€ ê³ ìœ í•´ì•¼ í•¨
    private String username;

    @Column(nullable = false) // ë¹„ë°€ë²ˆí˜¸ í•„ìˆ˜
    private String password;

    @Column(nullable = false, unique = true) // ì´ë©”ì¼ë„ ê³ ìœ í•´ì•¼ í•¨
    private String email;

    @ManyToMany(fetch = FetchType.EAGER, cascade = CascadeType.ALL)
    @JoinTable(
        name = "user_roles",
        joinColumns = @JoinColumn(name = "user_id"),
        inverseJoinColumns = @JoinColumn(name = "role_id")
    )
    private Set<Role> roles = new HashSet<>();
}
```

---

## 2. ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” ì²˜ë¦¬

**Spring Security**ì—ì„œ ì œê³µí•˜ëŠ” `BCryptPasswordEncoder`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•”í˜¸í™”í•©ë‹ˆë‹¤. ì•”í˜¸í™”ëœ ë¹„ë°€ë²ˆí˜¸ëŠ” DBì— ì €ì¥ë˜ë©°, ë‚˜ì¤‘ì— ì¸ì¦ ê³¼ì •ì—ì„œ ë¹„êµì— ì‚¬ìš©ë©ë‹ˆë‹¤.

---

## 3. íšŒì›ê°€ì… ë¡œì§

### **3.1 UserRepository ì‘ì„±**
`UserRepository`ëŠ” `User` ì—”í‹°í‹°ì™€ ì—°ê²°ë˜ì–´ ì‚¬ìš©ì ì •ë³´ë¥¼ ì €ì¥ ë° ì¡°íšŒí•©ë‹ˆë‹¤.

```java
package jpabook.jpashop.repository;

import jpabook.jpashop.domain.User;
import org.springframework.data.jpa.repository.JpaRepository;

import java.util.Optional;

public interface UserRepository extends JpaRepository<User, Long> {
    Optional<User> findByUsername(String username);
    Optional<User> findByEmail(String email);
}
```

---

### **3.2 íšŒì›ê°€ì… API**

ì»¨íŠ¸ë¡¤ëŸ¬ì— íšŒì›ê°€ì… APIë¥¼ ì‘ì„±í•©ë‹ˆë‹¤. ì‚¬ìš©ì ë“±ë¡ ì‹œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•”í˜¸í™”í•˜ì—¬ ì €ì¥í•©ë‹ˆë‹¤.

#### **UserRequest DTO**
íšŒì›ê°€ì… ì‹œ í•„ìš”í•œ ì…ë ¥ ë°ì´í„°ë¥¼ ì „ë‹¬ë°›ê¸° ìœ„í•œ DTO(Data Transfer Object)ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.

```java
package jpabook.jpashop.dto;

import lombok.Getter;
import lombok.Setter;

@Getter @Setter
public class UserSignupRequest {
    private String username;
    private String password;
    private String email;
}
```

#### **UserController**
íšŒì›ê°€ì… APIë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.

```java
package jpabook.jpashop.api;

import jpabook.jpashop.domain.Role;
import jpabook.jpashop.domain.User;
import jpabook.jpashop.dto.UserSignupRequest;
import jpabook.jpashop.repository.RoleRepository;
import jpabook.jpashop.repository.UserRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.web.bind.annotation.*;

import java.util.Collections;

@RestController
@RequestMapping("/api/auth")
@RequiredArgsConstructor
public class AuthController {

    private final UserRepository userRepository;
    private final RoleRepository roleRepository;
    private final PasswordEncoder passwordEncoder; // ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”ë¥¼ ìœ„í•œ ì¸ì½”ë”

    // íšŒì›ê°€ì… ì—”ë“œí¬ì¸íŠ¸
    @PostMapping("/signup")
    public String signup(@RequestBody UserSignupRequest request) {
        // ì‚¬ìš©ì ì´ë¦„ê³¼ ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸
        if (userRepository.findByUsername(request.getUsername()).isPresent()) {
            return "ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì‚¬ìš©ì ì´ë¦„ì…ë‹ˆë‹¤.";
        }

        if (userRepository.findByEmail(request.getEmail()).isPresent()) {
            return "ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼ì…ë‹ˆë‹¤.";
        }

        // ê¸°ë³¸ ROLE_USER ë¶€ì—¬
        Role userRole = roleRepository.findByName("ROLE_USER")
                .orElseThrow(() -> new IllegalStateException("ê¸°ë³¸ ì—­í• ì´ ì„¤ì •ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤."));

        // ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”
        String encryptedPassword = passwordEncoder.encode(request.getPassword());

        // ì‚¬ìš©ì ì €ì¥
        User user = User.builder()
                .username(request.getUsername())
                .password(encryptedPassword)
                .email(request.getEmail())
                .roles(Collections.singleton(userRole)) // ê¸°ë³¸ì ìœ¼ë¡œ ROLE_USER ë¶€ì—¬
                .build();

        userRepository.save(user);
        return "íšŒì›ê°€ì… ì™„ë£Œ!";
    }
}
```

---

### **3.3 RoleRepository ì‘ì„±**

íšŒì›ì—ê²Œ ROLE_USER, ROLE_ADMIN ë“±ì˜ ì—­í• ì„ ë¶€ì—¬í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. `RoleRepository`ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

```java
package jpabook.jpashop.repository;

import jpabook.jpashop.domain.Role;
import org.springframework.data.jpa.repository.JpaRepository;

import java.util.Optional;

public interface RoleRepository extends JpaRepository<Role, Long> {
    Optional<Role> findByName(String name);
}
```

---

## 4. ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ ì²˜ë¦¬

ë¹„ë°€ë²ˆí˜¸ëŠ” ë³µí˜¸í™”ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ, ì‚¬ìš©ì ë¡œê·¸ì¸ ì‹œ ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ DBì— ì €ì¥ëœ í•´ì‹œ ê°’ê³¼ ë¹„êµí•´ì•¼ í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ Spring Securityì˜ **PasswordEncoder.matches()** ë©”ì„œë“œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

```java
package jpabook.jpashop.service;

import jpabook.jpashop.domain.User;
import jpabook.jpashop.repository.UserRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Service;

@Service
@RequiredArgsConstructor
public class AuthService {

    private final UserRepository userRepository;
    private final PasswordEncoder passwordEncoder;

    public boolean login(String username, String rawPassword) {
        User user = userRepository.findByUsername(username)
                .orElseThrow(() -> new IllegalArgumentException("ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."));

        // ì…ë ¥ëœ ë¹„ë°€ë²ˆí˜¸(rawPassword)ì™€ ì•”í˜¸í™”ëœ ë¹„ë°€ë²ˆí˜¸ ë¹„êµ
        return passwordEncoder.matches(rawPassword, user.getPassword());
    }
}
```

---

## 5. Spring Security ì„¤ì •

Spring Security ì„¤ì •ì—ì„œ ì•”í˜¸í™”ë¥¼ ìœ„í•œ `PasswordEncoder`ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•©ë‹ˆë‹¤.

```java
package jpabook.jpashop.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;

@Configuration
public class SecurityConfig {

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}
```

---

## 6. ì´ˆê¸° ë°ì´í„° ì„¤ì •

ê¸°ë³¸ ì—­í• (Role)ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ë“±ë¡í•©ë‹ˆë‹¤. ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì‹œ ROLE_USERì™€ ROLE_ADMINì„ ì¶”ê°€í•˜ê¸° ìœ„í•´ `CommandLineRunner`ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

```java
package jpabook.jpashop;

import jpabook.jpashop.domain.Role;
import jpabook.jpashop.repository.RoleRepository;
import org.springframework.boot.CommandLineRunner;
import org.springframework.stereotype.Component;

@Component
public class DataInitializer implements CommandLineRunner {

    private final RoleRepository roleRepository;

    public DataInitializer(RoleRepository roleRepository) {
        this.roleRepository = roleRepository;
    }

    @Override
    public void run(String... args) throws Exception {
        // ê¸°ë³¸ ì—­í•  ë“±ë¡
        if (roleRepository.findByName("ROLE_USER").isEmpty()) {
            roleRepository.save(Role.builder().name("ROLE_USER").build());
        }

        if (roleRepository.findByName("ROLE_ADMIN").isEmpty()) {
            roleRepository.save(Role.builder().name("ROLE_ADMIN").build());
        }
    }
}
```

---

## 7. ê°„ë‹¨í•œ React íšŒì›ê°€ì… í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„

Reactì—ì„œ íšŒì›ê°€ì… í¼ê³¼ ì„œë²„ì™€ì˜ í†µì‹ ì„ ì‘ì„±í•©ë‹ˆë‹¤.

```
import React, { useState } from "react";
import axios from "axios";

const Signup = () => {
    const [form, setForm] = useState({
        username: "",
        password: "",
        email: ""
    });

    const handleChange = (e) => {
        const { name, value } = e.target;
        setForm({ ...form, [name]: value });
    };

    const handleSubmit = async (e) => {
        e.preventDefault();
        try {
            const response = await axios.post("http://localhost:8080/api/auth/signup", form);
            alert(response.data);
        } catch (error) {
            console.error("íšŒì›ê°€ì… ì¤‘ ì˜¤ë¥˜:", error);
        }
    };

    return (
        <div>
            <h1>íšŒì›ê°€ì…</h1>
            <form onSubmit={handleSubmit}>
                <div>
                    <label>ì‚¬ìš©ì ì´ë¦„</label>
                    <input type="text" name="username" onChange={handleChange} required />
                </div>
                <div>
                    <label>ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" name="password" onChange={handleChange} required />
                </div>
                <div>
                    <label>ì´ë©”ì¼</label>
                    <input type="email" name="email" onChange={handleChange} required />
                </div>
                <button type="submit">íšŒì›ê°€ì…</button>
            </form>
        </div>
    );
};

export default Signup;
```

---

## 8. í…ŒìŠ¤íŠ¸

1. Spring Boot ì„œë²„ ì‹¤í–‰.
2. React ì•± ì‹¤í–‰ ë° íšŒì›ê°€ì… í…ŒìŠ¤íŠ¸.
3. íšŒì›ê°€ì… í›„, ë°ì´í„°ë² ì´ìŠ¤ì— ì‚¬ìš©ì ì •ë³´ê°€ ì•”í˜¸í™”ëœ ë¹„ë°€ë²ˆí˜¸ì™€ í•¨ê»˜ ì €ì¥ë˜ëŠ”ì§€ í™•ì¸.

---

ì´ì œ íšŒì›ê°€ì… ê¸°ëŠ¥ì´ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ê° ì—­í• (Role)ì— ë”°ë¼ ê¶Œí•œì„ ë¶€ì—¬í•˜ê³ , ì¸ì¦ê³¼ ê¶Œí•œ ê´€ë¦¬ë¥¼ Spring Securityì™€ í•¨ê»˜ í™•ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ğŸ˜Š
